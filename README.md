# AllInOneAV
One place to manage AVs

自用AV整理，存储，播放及下载的全自动及半自动程序集，主要功能以Winform为主，为了方便开发了一些Web功能。仅适合自用，本人非大牛部分没有高级语法及组件运用，代码很多没有经过优化，前段(Winform及Html)只有凑合能用的水平，基本只适合做到思路启发的用途。

主要功能:

1 3种模式抓取Javlibray(网站启用强CloudFlare验证时，启动Chrome浏览器手动完成验证获取Cookie，弱CloudFlare验证时，用ChromeDrive半自动完成获取Cookie，没有启用CloudFlare时直接抓取，分别对应setting中database.ini的CookieMode Prcosee, Chrome, None 3种配置)

2 文件重命名 番号+名称+后缀，并支持查找重复(搜索每个盘符下面的fin文件夹中av文件，不能有子文件夹)

3 根据fin文件夹中的av文件做到匹配及搜索以及报表功能

4 合并多个av文件，例如abc-001A, abc-001B到abc-001，大部分可以自动完成，少数需要手动识别

5 根据筛选条件搜索Javlibray中的av条目并在Sukebei中搜索种子，有Winform端及Web端，Web短实现机制为根据筛选条件在数据库中插入一条任务，等Windows定时任务去数据库中抓取一条任务解析筛选条件并执行然后回写执行状态。Winform端及Web端均支持一键加入115下载（需要115客户端及刷新115Cookie的定时任务支持），Web端更好用，具体交互方式请自行查看代码。

6 其他还有一些小功能 ，比如批量转码h265，文件分享，去重等自己通过读代码或者亲自试验实验，功能不熟悉前建议用少量AV文件(比如在U盘等设备中试验，不要用于自己的仓库盘！！！！ 只要文件不再每个盘符根目录下的fin文件夹中就问题不大)

大概运行基础如下

1 运行Script中的脚本在本地Sqlserver数据库中建立库及表

2 导入Script的dataBak中的数据（JavLibrary中数据的快照，后续所有功能的依赖数据）

3 Setting复制到C:\根目录下

4 编译整个解决方案并按照ScheduleTask中的截图建立定时任务（具体路径按照自己环境更换）

我每天的整理流程

1 打开Winform执行刷新Javlibrary来更新网站中'新话题'中的200页的数据，如果库中不存在就抓取信息+保存封面图到本地

2 运行日常更新抓取JavLibrary中前X页的数据并搜索种子，蓝色背景为本地没有，绿色背景为本地存在,Winform中右键点击可以选择种子文件加入115下载，Web中左键高亮所有选中的种子文件点击下方下载按钮完成批量加入115功能

3 下载到本地以后执行‘去子文件夹功能’把av文件移动到movefile文件夹中，改操作为递归操作

4 批量重命名上一步的movefile文件夹，会把能自动操作的av文件重命名并移动到tempfin文件夹中

5 用手动重命名工具扫描movefile文件夹中剩余不能完成自动扫描的文件，该操作会移动文件到fin文件夹中

6 用生成合并任务扫描tempfin和fin文件夹，用来判断是否有重复文件或需要合并的文件，手动识别需要删除的文件，只留下真正需要合并的文件点击生成

7 用自动合并工具选择合并位置并自动合并上一步中的文件

8 等完成后回到生成合并任务中删除合并前的原始文件

9 移动刚才所有操作的文件到盘符根目录下的fin文件夹中(前几部中的操作均不应该在根目下完成！！！)，执行刷新匹配，待完成后执行去重操作
